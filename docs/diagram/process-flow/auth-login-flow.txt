# Authentication - Login Process Flow (ASCII)

```
╔════════════════════════════════════════════════════════════════════════════════╗
║                        USER LOGIN PROCESS FLOW                                  ║
╚════════════════════════════════════════════════════════════════════════════════╝


                              ┌─────────────┐
                              │   START     │
                              └──────┬──────┘
                                     │
                                     ▼
                          ┌──────────────────────┐
                          │  User visits         │
                          │  /login page         │
                          └──────────┬───────────┘
                                     │
                                     ▼
                          ┌──────────────────────┐
                          │  Display Login Form  │
                          │  - Email field       │
                          │  - Password field    │
                          │  - Remember Me       │
                          │  - Login button      │
                          └──────────┬───────────┘
                                     │
                                     ▼
                          ┌──────────────────────┐
                          │  User enters         │
                          │  credentials         │
                          └──────────┬───────────┘
                                     │
                                     ▼
                          ┌──────────────────────┐
                          │  Frontend validation │
                          └──────────┬───────────┘
                                     │
                       ┌─────────────┴─────────────┐
                       │                           │
                  [Valid?]                    [Invalid?]
                       │                           │
                   ┌───▼───┐                   ┌───▼───┐
                   │  YES  │                   │  NO   │
                   └───┬───┘                   └───┬───┘
                       │                           │
                       │                           ▼
                       │              ┌────────────────────────┐
                       │              │  Show validation error │
                       │              │  "Please fill required"│
                       │              │  "Invalid email format"│
                       │              └────────────┬───────────┘
                       │                           │
                       │                           │
                       │              ┌────────────┘
                       │              │
                       ▼              ▼
            ┌──────────────────────────────┐
            │  GET /sanctum/csrf-cookie    │
            │  (CSRF protection)           │
            └──────────────┬───────────────┘
                           │
                           ▼
            ┌──────────────────────────────┐
            │  POST /api/login             │
            │  {                           │
            │    email: "user@example.com" │
            │    password: "******"        │
            │    remember: false           │
            │  }                           │
            └──────────────┬───────────────┘
                           │
                           ▼
            ┌──────────────────────────────┐
            │  BACKEND: Validate Request   │
            │  - Check required fields     │
            │  - Validate email format     │
            └──────────────┬───────────────┘
                           │
                           ▼
            ┌──────────────────────────────┐
            │  Check if user exists        │
            │  (by email)                  │
            └──────────────┬───────────────┘
                           │
              ┌────────────┴────────────┐
              │                         │
         [Exists?]                  [Not found?]
              │                         │
          ┌───▼───┐                 ┌───▼───┐
          │  YES  │                 │  NO   │
          └───┬───┘                 └───┬───┘
              │                         │
              │                         ▼
              │            ┌─────────────────────────┐
              │            │  Return 401 Unauthorized│
              │            │  "Invalid credentials"  │
              │            └─────────────┬───────────┘
              │                          │
              │                          │
              ▼                          │
   ┌──────────────────────┐              │
   │  Check account status│              │
   │  - is_active?        │              │
   │  - is_locked?        │              │
   └──────────┬───────────┘              │
              │                          │
 ┌────────────┼────────────┬─────────────┤
 │            │            │             │
[Active?]  [Locked?]  [Inactive?]        │
 │            │            │             │
 ▼            ▼            ▼             │
┌──────┐  ┌───────┐  ┌─────────┐        │
│ YES  │  │  YES  │  │   YES   │        │
└──┬───┘  └───┬───┘  └────┬────┘        │
   │          │            │             │
   │          ▼            ▼             │
   │  ┌───────────────┐ ┌──────────────┐│
   │  │ Return 423    │ │ Return 403   ││
   │  │ "Account      │ │ "Account     ││
   │  │  locked"      │ │  inactive"   ││
   │  └───────────────┘ └──────────────┘│
   │                                     │
   ▼                                     │
┌──────────────────────┐                 │
│  Verify password     │                 │
│  Hash::check()       │                 │
└──────────┬───────────┘                 │
           │                             │
  ┌────────┴────────┐                    │
  │                 │                    │
[Correct?]     [Incorrect?]              │
  │                 │                    │
┌─▼──┐          ┌───▼───┐                │
│YES │          │  NO   │                │
└─┬──┘          └───┬───┘                │
  │                 │                    │
  │                 ▼                    │
  │   ┌─────────────────────────┐       │
  │   │ Increment failed_login  │       │
  │   │ _attempts counter       │       │
  │   └─────────────┬───────────┘       │
  │                 │                    │
  │            [Attempts >= 5?]          │
  │                 │                    │
  │        ┌────────┴────────┐           │
  │        │                 │           │
  │     [YES]             [NO]           │
  │        │                 │           │
  │        ▼                 │           │
  │   ┌─────────────┐        │           │
  │   │ Lock account│        │           │
  │   │ for 30 mins │        │           │
  │   └──────┬──────┘        │           │
  │          │               │           │
  │          └───────┬───────┘           │
  │                  │                   │
  │                  ▼                   │
  │   ┌──────────────────────────┐      │
  │   │ Log failed attempt       │      │
  │   │ (LoginActivity)          │      │
  │   └──────────────┬───────────┘      │
  │                  │                   │
  │                  ▼                   │
  │   ┌──────────────────────────┐      │
  │   │ Return 401 Unauthorized  │      │
  │   │ "Invalid credentials"    │◄─────┘
  │   └──────────────────────────┘
  │
  ▼
┌─────────────────────────┐
│ SUCCESS! Password valid │
└────────────┬────────────┘
             │
             ▼
┌─────────────────────────┐
│ Reset failed_login      │
│ _attempts to 0          │
└────────────┬────────────┘
             │
             ▼
┌─────────────────────────┐
│ Check if password       │
│ change is forced        │
└────────────┬────────────┘
             │
    ┌────────┴────────┐
    │                 │
[Forced?]        [Not forced?]
    │                 │
┌───▼───┐         ┌───▼───┐
│  YES  │         │  NO   │
└───┬───┘         └───┬───┘
    │                 │
    │                 ▼
    │    ┌─────────────────────────┐
    │    │ Create session/token    │
    │    │ (Laravel Sanctum)       │
    │    └────────────┬────────────┘
    │                 │
    │                 ▼
    │    ┌─────────────────────────┐
    │    │ Update last_login_at    │
    │    │ timestamp               │
    │    └────────────┬────────────┘
    │                 │
    │                 ▼
    │    ┌─────────────────────────┐
    │    │ Log successful login    │
    │    │ (LoginActivity)         │
    │    │ - IP address            │
    │    │ - User agent            │
    │    └────────────┬────────────┘
    │                 │
    │                 ▼
    │    ┌─────────────────────────┐
    │    │ Return 200 OK           │
    │    │ {                       │
    │    │   success: true,        │
    │    │   data: {               │
    │    │     user: {...}         │
    │    │   }                     │
    │    │ }                       │
    │    └────────────┬────────────┘
    │                 │
    │                 ▼
    │    ┌─────────────────────────┐
    │    │ Frontend: Store user    │
    │    │ in auth store (Zustand) │
    │    └────────────┬────────────┘
    │                 │
    │                 ▼
    │    ┌─────────────────────────┐
    │    │ Redirect to /dashboard  │
    │    └────────────┬────────────┘
    │                 │
    │                 ▼
    │         ┌───────────────┐
    │         │   SUCCESS!    │
    │         │   User logged │
    │         │   in          │
    │         └───────┬───────┘
    │                 │
    │                 ▼
    │            ┌─────────┐
    │            │   END   │
    │            └─────────┘
    │
    ▼
┌─────────────────────────────────┐
│ Set force_password_change flag  │
│ in response                     │
└────────────┬────────────────────┘
             │
             ▼
┌─────────────────────────────────┐
│ Frontend: Redirect to           │
│ /force-change-password          │
└────────────┬────────────────────┘
             │
             ▼
        ┌─────────┐
        │   END   │
        └─────────┘


═══════════════════════════════════════════════════════════════════════════════
SECURITY CHECKS SUMMARY:
═══════════════════════════════════════════════════════════════════════════════

1. ✓ Frontend validation
2. ✓ CSRF token verification
3. ✓ User existence check
4. ✓ Account status verification (active/locked/inactive)
5. ✓ Password verification (bcrypt)
6. ✓ Failed login attempt tracking
7. ✓ Automatic account locking (5 failed attempts)
8. ✓ Login activity logging
9. ✓ Force password change enforcement

═══════════════════════════════════════════════════════════════════════════════
ERROR RESPONSES:
═══════════════════════════════════════════════════════════════════════════════

401 Unauthorized   - Invalid credentials
403 Forbidden      - Account is inactive
423 Locked         - Account is locked (too many failed attempts)
422 Validation     - Invalid input format

═══════════════════════════════════════════════════════════════════════════════
```

